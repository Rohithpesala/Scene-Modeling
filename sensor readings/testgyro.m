clear all;
clc;
size = 315;
% M = csvread('rotlin_dc.csv',1,3,[1,3,size,5]);
M = dlmread('GRA_20160426_131634_756.txt',',');
M = M(:,1:3);
M(:,3) = -1*M(:,3);
size = length(M);
% G = csvread('rotlin_dc.csv',1,9,[1,9,size,11]);
G = dlmread('GYR_20160426_131634_756.txt',',');
G = G(:,1:3);
G(:,3) = -1*G(:,3);
% A = csvread('rotlin_dc.csv',1,6,[1,6,size,8]);
% A(:,3) = -1*A(:,3);
dt = 0.01;
V = M(1,:);
% V = V/norm(V);
rndv = [1,1,1];
Gguess = zeros(size,4);
h1 = cross(rndv,V);
h1 = h1/norm(h1);
h2 = cross(V,h1);
h2 = h2/norm(h2);
p1 = [V;h1;h2];
for i=2:size
    scale_n = 100;
    phi_x = (G(i,1)*dt)/180*(pi/scale_n);
    phi_y = (G(i,2)*dt)/180*(pi/scale_n);
    phi_z = (G(i,3)*dt)/180*(pi/scale_n);
    R_x = [1 0 0;0 cos(phi_x) -sin(phi_x);0 sin(phi_x) cos(phi_x)];
    R_y = [cos(phi_y) 0 sin(phi_y);0 1 0;-sin(phi_y) 0 cos(phi_y)];
    R_z = [cos(phi_z) -sin(phi_z) 0;sin(phi_z) cos(phi_z) 0;0 0 1];
    Rt = R_x*R_y*R_z;
    Rf = Rt^scale_n;
    p1 = p1*inv(Rf);
    Gguess(i,1:3) = p1(1,:);
    Gguess(i,4) = p1(1,:)*M(i,:)';
end
M = [M Gguess];